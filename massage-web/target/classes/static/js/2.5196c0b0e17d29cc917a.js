webpackJsonp([2],{OfWw:function(s,e){},QlWu:function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t("Xxa5"),i=t.n(n),a=t("exGp"),o=t.n(a),u=t("mvHQ"),r=t.n(u),c=t("RtM3"),l=(t("RAPA"),t("Fd2+")),h={name:"search",props:{businessList:{type:Array,default:[]}},data:function(){return{businessVal:"",list:[],loading:!1,finished:!0,isShowList:!1}},watch:{businessVal:function(s,e){var t=this.$props.businessList.filter(function(e,t){return e.businessName===s});console.log("watch触发",t),this.$emit("changeBusinessVal",t.length>0?t[0].businessId:null)}},computed:{isShow:function(){return this.list.length>0&&this.businessVal.length>0}},methods:{getVal:function(s){this.businessVal=s,this.list=this.$props.businessList.map(function(s){return s.businessName}).filter(function(e){return e.includes(s)})},onLoad:function(){},toggleVal:function(s){this.list=[],this.businessVal=s}}},d={render:function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",{staticClass:"search"},[t("div",{staticClass:"search-items"},[t("div",[t("van-cell-group",[t("van-field",{attrs:{type:"businessId",placeholder:"请输入商家"},on:{input:s.getVal},model:{value:s.businessVal,callback:function(e){s.businessVal=e},expression:"businessVal"}})],1)],1),s._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:s.isShow,expression:"isShow"}],staticClass:"business-list"},[t("van-list",{attrs:{finished:s.finished,"finished-text":""},on:{load:s.onLoad},model:{value:s.loading,callback:function(e){s.loading=e},expression:"loading"}},s._l(s.list,function(e){return t("van-cell",{key:e,attrs:{title:e},on:{click:function(t){s.toggleVal(e)}}})}),1)],1)])])},staticRenderFns:[]};var m={components:{Search:t("VU/8")(h,d,!1,function(s){t("OfWw")},"data-v-64e865c0",null).exports},data:function(){return{navBar:["顾客","商家","老师"],actionIndex:0,customerList:{userName:"",userPhone:"",type:"",businessId:""},businessList:{businessName:"",businessId:""},teacherList:{userPhone:"",password:"",businessId:"",type:2},showCustomerPicker:!1,showBusinessPicker:!1,showTeacherPicker1:!1,showTeacherPicker2:!1,business:[],businessData:[],equipmentList:[],equipmentListData:[],teacherPickerLoading:!0,phoneReg:/^1[3456789]\d{9}$/,businessId:"",loading:!0,openId:""}},created:function(){document.title="登录",2==this.actionIndex&&this.getbusinessList()},methods:{getbusinessData:function(s){var e=this,t={};(0!=s||this.customerList.userName||this.customerList.userPhone)&&(1!=s||this.customerList.businessId)?(0==s?(t={type:0,userName:this.customerList.userName,userPhone:this.customerList.userPhone},this.showCustomerPicker=!0):1==s&&(t={type:1,password:this.customerList.businessId},this.showBusinessPicker=!0),Object(c.i)(t).then(function(s){e.loading=!1,"000000"==s.code&&(e.businessData=s.data.length>0?s.data:[],e.business=s.data.length>0?s.data.map(function(s){return s.businessName}):[])})):l.c.fail("请输入完整内容")},changeBusinessVal:function(s){this.$set(this.teacherList,"businessId",s)},openEquipmentList:function(){var s=this,e="";this.teacherList.business?(this.showTeacherPicker2=!0,this.businessData.map(function(t,n){t.businessName===s.teacherList.business&&(e=t.businessId)}),this.getEquipmentList({businessId:e,type:1})):l.c.fail("请先选择商家")},formatData:function(s,e){var t=JSON.parse(r()(e));return console.log("newData",t),1===s?(t.type=0,this.businessData.map(function(s,e){s.businessName===t.businessId&&(t.businessId=s.businessId)}),t):2===s?(t.type=1,this.businessData.map(function(s,e){s.businessName===t.businessId&&(t.businessId=s.businessId)}),t):void 0},getbusinessList:function(){var s=this;Object(c.b)().then(function(e){"000000"==e.code&&(s.businessData=e.data.length>0?e.data:[],s.business=e.data.length>0?e.data.map(function(s){return s.businessName}):[])})},getEquipmentList:function(s){var e=this;Object(c.d)(s).then(function(s){"000000"==s.code&&(e.equipmentListData=s.data.length>0?s.data:[],e.equipmentList=s.data.length>0?s.data.map(function(s){return s.equipmentId}):[],e.teacherPickerLoading=!1)})},toggleIdentity:function(s){this.actionIndex=s,this.customerList={name:"",phone:"",business:""},this.businessList={businessName:"",businessId:""},this.teacherList={userPhone:"",password:"",businessId:"",type:2},2==s&&this.getbusinessList()},customerToggle:function(s){this.$set(this.customerList,"businessId",s),this.showCustomerPicker=!1},businessToggle:function(s){this.$set(this.businessList,"businessName",s),this.showBusinessPicker=!1},teacherBusinessToggle:function(s){this.$set(this.teacherList,"business",s),this.showTeacherPicker1=!1},teacherEquipmentToggle:function(s){this.$set(this.teacherList,"equipmentId",s),this.showTeacherPicker2=!1},onCustomerSubmit:function(s){var e=this;return o()(i.a.mark(function t(){var n;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=e,Object(c.f)(e.formatData(1,s)).then(function(s){"000000"===s.code?(localStorage.setItem("userInfo",r()(s.data.userInfo)),l.c.success({duration:500,message:"登录成功",onClose:function(){n.$router.push("customerPage")}})):l.c.fail(s.msg)});case 2:case"end":return t.stop()}},t,e)}))()},onBusinessSubmit:function(s){var e=this;Object(c.f)(this.formatData(2,s)).then(function(s){"000000"===s.code?(localStorage.setItem("userInfo",r()(s.data.userInfo)),l.c.success({duration:500,message:"登录成功",onClose:function(){e.$router.push("businessPage")}})):l.c.fail(s.msg)})},onTeacherSubmit:function(s){var e=this;this.teacherList.userPhone?this.teacherList.password?this.teacherList.businessId?Object(c.f)(this.teacherList).then(function(s){"000000"===s.code?(localStorage.setItem("userInfo",r()(s.data.userInfo)),l.c.success({duration:500,message:"登录成功",onClose:function(){e.$router.push("teacher")}})):l.c.fail(s.msg)}):l.c.fail("商家名有误！"):l.c.fail("密码有误！"):l.c.fail("手机号码有误！")},jumpEquipment:function(){this.$router.push("addEquipment")}}},b={render:function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",{staticClass:"login"},[t("div",{staticClass:"login-header"},s._l(s.navBar,function(e,n){return t("div",{key:n,staticClass:"header-btn"},[t("van-button",{attrs:{round:"",block:"",color:s.actionIndex===n?"#494949":""},on:{click:function(e){s.toggleIdentity(n)}}},[s._v(s._s(e))])],1)}),0),s._v(" "),t("div",{staticClass:"login-content"},[t("div",{staticClass:"content-form"},[t("div",{directives:[{name:"show",rawName:"v-show",value:0==s.actionIndex,expression:"actionIndex==0"}],staticClass:"form-customer"},[t("van-form",{on:{submit:s.onCustomerSubmit}},[t("van-field",{attrs:{name:"userName",placeholder:"请输入姓名",rules:[{required:!0,message:"请填写姓名"}]},model:{value:s.customerList.userName,callback:function(e){s.$set(s.customerList,"userName",e)},expression:"customerList.userName"}}),s._v(" "),t("van-field",{attrs:{type:"tel",name:"userPhone",placeholder:"请输入手机号码",rules:[{pattern:s.phoneReg,message:"手机号格式不正确"}]},model:{value:s.customerList.userPhone,callback:function(e){s.$set(s.customerList,"userPhone",e)},expression:"customerList.userPhone"}}),s._v(" "),t("van-field",{attrs:{readonly:"",clickable:"",name:"businessId",value:s.customerList.businessId,placeholder:"商家选择",rules:[{required:!0,message:"请选择商家"}]},on:{click:function(e){s.getbusinessData(0)}}}),s._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:s.showCustomerPicker,callback:function(e){s.showCustomerPicker=e},expression:"showCustomerPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",loading:s.loading,columns:s.business},on:{confirm:s.customerToggle,cancel:function(e){s.showCustomerPicker=!1}}})],1),s._v(" "),t("div",{staticClass:"login-sub"},[t("van-button",{attrs:{color:"linear-gradient(to right, #6F6F6F , #414141)",round:"",block:"","native-type":"submit"}},[s._v("提交")])],1)],1)],1),s._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:1==s.actionIndex,expression:"actionIndex==1"}],staticClass:"form-business"},[t("van-form",{on:{submit:s.onBusinessSubmit}},[t("van-field",{attrs:{name:"password",type:"password",placeholder:"请输入商家身份码",rules:[{required:!0,message:"请输入商家身份码"}]},model:{value:s.customerList.businessId,callback:function(e){s.$set(s.customerList,"businessId",e)},expression:"customerList.businessId"}}),s._v(" "),t("van-field",{attrs:{readonly:"",clickable:"",name:"businessId",value:s.businessList.businessName,placeholder:"商家选择名称",rules:[{required:!0,message:"请选择商家"}]},on:{click:function(e){s.getbusinessData(1)}}}),s._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:s.showBusinessPicker,callback:function(e){s.showBusinessPicker=e},expression:"showBusinessPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",loading:s.loading,columns:s.business},on:{confirm:s.businessToggle,cancel:function(e){s.showBusinessPicker=!1}}})],1),s._v(" "),t("div",{staticClass:"login-sub"},[t("van-button",{attrs:{color:"linear-gradient(to right, #6F6F6F , #414141)",round:"",block:"","native-type":"submit"}},[s._v("提交")])],1)],1)],1),s._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:2==s.actionIndex,expression:"actionIndex==2"}],staticClass:"form-teacher"},[t("van-field",{attrs:{name:"userPhone",placeholder:"请输入老师ID",rules:[{pattern:s.phoneReg,message:"老师ID格式错误"}]},model:{value:s.teacherList.userPhone,callback:function(e){s.$set(s.teacherList,"userPhone",e)},expression:"teacherList.userPhone"}}),s._v(" "),t("van-field",{attrs:{name:"password",type:"password",placeholder:"请输入老师身份码",rules:[{required:!0,message:"请输入老师身份码"}]},model:{value:s.teacherList.password,callback:function(e){s.$set(s.teacherList,"password",e)},expression:"teacherList.password"}}),s._v(" "),t("Search",{attrs:{businessList:s.businessData},on:{changeBusinessVal:s.changeBusinessVal}}),s._v(" "),t("div",{staticClass:"login-sub btn1"},[t("van-button",{attrs:{color:"linear-gradient(to right, #6F6F6F , #414141)",round:"",block:""},on:{click:s.onTeacherSubmit}},[s._v("提交")])],1),s._v(" "),t("div",{staticClass:"login-sub btn2"},[t("van-button",{attrs:{color:"linear-gradient(to right, #6F6F6F , #414141)",round:"",block:""},on:{click:s.jumpEquipment}},[s._v("添加设备")])],1)],1)])])])},staticRenderFns:[]};var f=t("VU/8")(m,b,!1,function(s){t("xAd2")},null,null);e.default=f.exports},mvHQ:function(s,e,t){s.exports={default:t("qkKv"),__esModule:!0}},qkKv:function(s,e,t){var n=t("FeBl"),i=n.JSON||(n.JSON={stringify:JSON.stringify});s.exports=function(s){return i.stringify.apply(i,arguments)}},xAd2:function(s,e){}});
//# sourceMappingURL=2.5196c0b0e17d29cc917a.js.map